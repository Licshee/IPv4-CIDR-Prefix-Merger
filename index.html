<!DOCTYPE html>
<title>IPv4 CIDR Prefix Merger</title>
<style>
* { box-sizing: border-box; }
html, body { height: 100%; }
html { padding: 8px; }
body { margin: 0; }
textarea { width: 50%; height: 100%; }
</style>
<textarea id="enter"># Input your IPv4 CIDR prefixes here, one prefix per line.
192.168.0.0/24
192.168.1.0/24
192.168.88.0/24
172.16.0.0/12
10.0.0.0/8
100.64.0.0/10
</textarea><textarea id="leave" readonly></textarea>
<script src="BinaryPrefixMerger.js"></script>
<script>
var d = 0x100000000.toString(2).substr(1);
var p = /([1-9]?[0-9]|1[0-9]{2}|2(?:[0-4][0-9]|5[0-5]))/.source;
var r = new RegExp(p + "\\." + p + "\\." + p + "\\." + p + "\\/" + /([12]?[0-9])/.source);
function bits(s) {
	switch(arguments.length) {
		case 1:
			if(Object.prototype.toString.call(s) === "[object String]") {
				if(/^[01]+$/.test(s)) break;
				var m = r.exec(s);
				s = m[1] * 16777216 + m[2] * 65536 + m[3] * 256 + m[4] * 1;
				s = s.toString(2);
				s = (d + s).substr(s.length, m[5]);
				break;
			};
		default:
			throw "WTF!?";
	}
	s = s.split('');
	s.push(null);
	return function() { return JSON.parse(s.shift()) };
}
function $refresh(){
	var result = '';
	function append(s){
		var l = s.length;
		s = s + d;
		s = parseInt(s.substr(0, 8), 2) + '.'
		  + parseInt(s.substr(8, 8), 2) + '.'
		  + parseInt(s.substr(16, 8), 2) + '.'
		  + parseInt(s.substr(24, 8), 2) + '/'
		  + l;
		result += s + '\r\n';
	}
	function dump(o, bits, bit){
		bits += bit;
		o = o[bit];
		if(o){
			dump(o, bits, 0), dump(o, bits, 1)
		}else if(o === null) append(bits);
	}

	var txt = enter.value.split(/\r\n?|\n/);
	var o = merger(bits);
	try{
		for(var i = 0; i < txt.length; i++){
			var line = txt[i];
			if(/^(#|\s*$)/.test(line)) continue;
			o.push(line);
		}
		dump(o, '', 0), dump(o, '', 1);
		leave.value = result;
	}catch(ex){
		leave.value = ex;
	}
};
var last;
function $changed(){
	clearTimeout(last);
	last = setTimeout($refresh, 0);
}
with(enter){
  onkeyup =
	oncut = onpaste = $changed;
}
$changed();
</script>
